import{c as D,r as N,d as A,j as r}from"./index-DX4BysHX.js";const R=D("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),V=({data:s,showStats:P=!0,showBuySignals:v=!1})=>{const M=N.useRef(null),f=N.useRef(null),[C,k]=N.useState(!1),p=A.useMemo(()=>{if(!s||s.length<20)return[];const c=[],i=t=>{const n=[];for(let l=t-1;l<s.length;l++){const o=s.slice(l-t+1,l+1).reduce((m,u)=>m+u.close,0);n.push(o/t)}return n},x=i(20),b=i(50),g=((t=14)=>{const n=[];for(let l=t;l<s.length;l++){let o=0,m=0;for(let d=l-t+1;d<=l;d++){const h=s[d].close-s[d-1].close;h>0?o+=h:m-=h}const u=o/t,w=m/t,L=100-100/(1+u/w);n.push(L)}return n})();for(let t=50;t<s.length;t++){const n=s[t].close,l=s[t].volume,o=s[t-1].close,m=s.slice(Math.max(0,t-20),t).reduce((a,y)=>a+y.volume,0)/Math.min(20,t),u=s.slice(Math.max(0,t-10),t+1).map(a=>a.close),w=u.reduce((a,y)=>a+y,0)/u.length,S=u.reduce((a,y)=>a+Math.pow(y-w,2),0)/u.length,L=Math.sqrt(S)/w;let d="weak",h="";t>=50&&x[t-20]>b[t-50]&&x[t-21]<=b[t-51]&&x[t-20]>x[t-21]*1.01?(h="골든크로스 (20일선 > 50일선)",d="strong"):t>=14&&g[t-14]<25&&n>o*1.02&&n>Math.min(...s.slice(Math.max(0,t-5),t).map(a=>a.close))*1.01?(h="RSI 과매도 구간에서 반등",d="medium"):l>m*2&&n>o*1.03&&n>Math.min(...s.slice(Math.max(0,t-10),t).map(a=>a.close))*1.02?(h="거래량 급증 + 가격 상승",d="medium"):n>o*1.02&&n>Math.min(...s.slice(Math.max(0,t-15),t).map(a=>a.low))*1.02&&l>m*1.5?(h="지지선 근처에서 반등",d="weak"):t>=5&&n>o*1.01&&o>s[t-2].close*1.01&&s[t-2].close>s[t-3].close*1.01&&s[t-3].close>s[t-4].close*1.01&&s[t-4].close>s[t-5].close*1.01&&l>m*1.2?(h="연속 상승 패턴",d="medium"):n>o*1.08&&l>m*2.5&&L<.1?(h="가격 급등",d="strong"):l>m*3&&n>o*1.02&&n>Math.min(...s.slice(Math.max(0,t-20),t).map(a=>a.close))*1.03&&(h="거래량 급증",d="weak"),h&&c.push({date:s[t].date,price:n,reason:h,strength:d})}return console.log(`매수 신호 분석 결과: ${c.length}개의 신호 발견`),console.log("신호 상세:",c),c},[s]),j=A.useMemo(()=>{if(!s||s.length===0)return null;const c=s.map(o=>o.close),i=s.map(o=>o.volume),x=s.map(o=>o.high),b=s.map(o=>o.low),e=c.reduce((o,m)=>o+m,0)/c.length,g=Math.max(...x),t=Math.min(...b),n=i.reduce((o,m)=>o+m,0),l=n/i.length;return{avgPrice:Math.round(e),maxPrice:g,minPrice:t,totalVolume:n,avgVolume:Math.round(l),priceChange:g-t,priceChangePercent:((g-t)/t*100).toFixed(1)}},[s]);return N.useEffect(()=>{(async()=>{if(window.ApexCharts){k(!0);return}try{const i=document.createElement("script");i.src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.1/dist/apexcharts.min.js",i.onload=()=>k(!0),i.onerror=()=>console.error("ApexCharts 로드 실패"),document.head.appendChild(i)}catch(i){console.error("ApexCharts 로드 중 오류:",i)}})()},[]),N.useEffect(()=>{if(!C||!M.current||!s.length)return;f.current&&f.current.destroy();const c=s.map(e=>({x:new Date(e.date).getTime(),y:[isNaN(e.open)?0:e.open,isNaN(e.high)?0:e.high,isNaN(e.low)?0:e.low,isNaN(e.close)?0:e.close]})),i=s.map(e=>({x:new Date(e.date).getTime(),y:isNaN(e.volume)?0:e.volume}));s.map(e=>e.date||"").filter(e=>e);const x=v?p.map(e=>({x:new Date(e.date).getTime(),y:e.price})):[];console.log("매수 신호 차트 데이터:",x),console.log("showBuySignals:",v),console.log("buySignals.length:",p.length),console.log("매수 신호 annotations:",v?p.map(e=>({x:new Date(e.date).getTime(),y:e.price,strength:e.strength})):[]);const b={chart:{type:"candlestick",height:400,toolbar:{show:!1},animations:{enabled:!0,easing:"easeinout",speed:800},stacked:!1,zoom:{enabled:!0}},series:[{name:"배출권 가격",type:"candlestick",data:c},{name:"거래량",type:"column",data:i,opacity:.6}],xaxis:{type:"datetime",title:{text:"날짜"},labels:{format:"MM/dd",rotate:-45,rotateAlways:!1},tickAmount:12},yaxis:[{title:{text:"가격 (원)"},min:Math.min(...s.map(e=>e.low))*.95,max:Math.max(...s.map(e=>e.high))*1.05,labels:{formatter:function(e){return e.toLocaleString()}}},{opposite:!0,title:{text:"거래량"},min:0,max:Math.max(...s.map(e=>e.volume))*1.1,labels:{formatter:function(e){return(e/1e3).toFixed(0)+"K"}}}],title:{text:"KAU24 배출권 시장 동향 (OHLC)",align:"center",style:{fontSize:"16px",fontWeight:"bold"}},colors:["#3b82f6","#e5e7eb","#10b981"],plotOptions:{candlestick:{colors:{upward:"#10b981",downward:"#ef4444"},wick:{useFillColor:!0}},bar:{columnWidth:"60%"},scatter:{size:8,strokeWidth:2,strokeColor:"#ffffff"}},tooltip:{enabled:!0,theme:"light",x:{format:"MM/dd/yyyy"},y:{formatter:function(e,{seriesIndex:g,dataPointIndex:t,w:n}){if(g===0){const l=n.globals.seriesCandleO[g][t];return[`시가: ${l[0].toLocaleString()}원`,`고가: ${l[1].toLocaleString()}원`,`저가: ${l[2].toLocaleString()}원`,`종가: ${l[3].toLocaleString()}원`].join("<br>")}else if(g===1)return`거래량: ${e.toLocaleString()}`;return`${e.toLocaleString()}원`}}},grid:{borderColor:"#e5e7eb",strokeDashArray:5},annotations:v?{points:p.map((e,g)=>({x:new Date(e.date).getTime(),y:e.price,marker:{size:e.strength==="strong"?8:e.strength==="medium"?6:4,fillColor:e.strength==="strong"?"#10b981":e.strength==="medium"?"#f59e0b":"#6b7280",strokeColor:"#ffffff",strokeWidth:2,radius:2},label:{borderColor:e.strength==="strong"?"#10b981":e.strength==="medium"?"#f59e0b":"#6b7280",borderWidth:1,text:(e.strength==="strong"||e.strength==="medium","●"),style:{color:"#ffffff",background:e.strength==="strong"?"#10b981":e.strength==="medium"?"#f59e0b":"#6b7280"}}}))}:void 0};return f.current=new window.ApexCharts(M.current,b),f.current.render(),()=>{f.current&&f.current.destroy()}},[s,C]),C?!s||s.length===0?r.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsx("div",{className:"text-center",children:r.jsx("p",{className:"text-gray-600",children:"시장 데이터가 없습니다."})})})}):r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:[r.jsx("div",{ref:M}),P&&j&&r.jsxs("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[r.jsx("div",{className:"text-sm font-medium text-blue-600",children:"평균 종가"}),r.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[j.avgPrice.toLocaleString(),"원"]})]}),r.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[r.jsx("div",{className:"text-sm font-medium text-green-600",children:"최고가"}),r.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[j.maxPrice.toLocaleString(),"원"]})]}),r.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[r.jsx("div",{className:"text-sm font-medium text-red-600",children:"최저가"}),r.jsxs("div",{className:"text-2xl font-bold text-red-900",children:[j.minPrice.toLocaleString(),"원"]})]}),r.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[r.jsx("div",{className:"text-sm font-medium text-purple-600",children:"총 거래량"}),r.jsxs("div",{className:"text-2xl font-bold text-purple-900",children:[(j.totalVolume/1e3).toFixed(0),"K"]})]})]}),v&&p.length>0&&r.jsxs("div",{className:"mt-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["최적 매수 타이밍 분석 (",p.length,"개 신호 발견)"]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.slice(-10).reverse().map((c,i)=>r.jsxs("div",{className:`rounded-lg p-4 border ${c.strength==="strong"?"bg-green-50 border-green-200":c.strength==="medium"?"bg-yellow-50 border-yellow-200":"bg-gray-50 border-gray-200"}`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium text-gray-600",children:new Date(c.date).toLocaleDateString()}),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${c.strength==="strong"?"bg-green-100 text-green-800":c.strength==="medium"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:c.strength==="strong"?"강한 신호":c.strength==="medium"?"보통 신호":"약한 신호"})]}),r.jsxs("div",{className:"text-lg font-bold text-gray-900 mb-1",children:[c.price.toLocaleString(),"원"]}),r.jsx("div",{className:"text-sm text-gray-600",children:c.reason})]},i))}),r.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[r.jsxs("p",{children:["• ",r.jsx("strong",{children:"강한 신호"}),": 골든크로스, 가격 급등 (8% 이상)"]}),r.jsxs("p",{children:["• ",r.jsx("strong",{children:"보통 신호"}),": RSI 과매도 반등, 거래량 급증 + 가격 상승, 연속 상승 패턴"]}),r.jsxs("p",{children:["• ",r.jsx("strong",{children:"약한 신호"}),": 지지선 근처 반등, 거래량 급증"]}),r.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"⚠️ 보수적 분석: 신호가 적게 나타나지만 더 신뢰할 수 있는 매수 타이밍을 제시합니다."})]})]})]}):r.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:"차트 준비 중입니다..."})]})})})};export{R as L,V as M};
